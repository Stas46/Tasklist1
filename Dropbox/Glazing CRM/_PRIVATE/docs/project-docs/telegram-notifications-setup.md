# –ò–º–ø–æ—Ä—Ç –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Notifications Workflow

## –®–∞–≥ 1: –ò–º–ø–æ—Ä—Ç workflow –≤ n8n

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://n8n.alu.stella-spb.ru
2. –í–æ–π–¥–∏—Ç–µ (admin / your_password)
3. –ù–∞–∂–º–∏—Ç–µ **"+"** ‚Üí **"Import from File"**
4. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª: `/var/www/alu.stella-spb.ru/n8n/workflows/telegram-notifications.json`
5. –ù–∞–∂–º–∏—Ç–µ **"Import"**

–ò–ª–∏ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ):
```bash
# –§–∞–π–ª —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ls -la /var/www/alu.stella-spb.ru/n8n/workflows/telegram-notifications.json
```

## –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ workflow

Workflow –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–æ–¥—ã:
1. **Notification Webhook** - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç POST –Ω–∞ `/webhook/telegram-notify`
2. **Is Task Created?** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `type == "task_created"`
3. **Format Task Message** - —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è Telegram
4. **Send Telegram Message** - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ Telegram Bot API
5. **Success Response** - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç success: true
6. **Skip Response** - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –µ—Å–ª–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø

## –®–∞–≥ 3: –ê–∫—Ç–∏–≤–∞—Ü–∏—è

1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ workflow **Active** (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–≤–µ—Ä—Ö—É —Å–ø—Ä–∞–≤–∞)
2. –ù–∞–∂–º–∏—Ç–µ **Save**

## –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ß–µ—Ä–µ–∑ curl (–ø–æ–ª—É—á–∏—Ç–µ –≤–∞—à Telegram ID)

–°–Ω–∞—á–∞–ª–∞ —É–∑–Ω–∞–π—Ç–µ —Å–≤–æ–π Telegram ID:
1. –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É @userinfobot –≤ Telegram
2. –û–Ω –ø–æ–∫–∞–∂–µ—Ç –≤–∞—à ID (–Ω–∞–ø—Ä–∏–º–µ—Ä: 123456789)

–ó–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:

```bash
curl -X POST https://n8n.alu.stella-spb.ru/webhook/telegram-notify \
  -H "Content-Type: application/json" \
  -d '{
    "type": "task_created",
    "task": {
      "id": "test-123",
      "title": "–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –∏–∑ n8n",
      "priority": 1,
      "quadrant": "1-todo",
      "deadline": "2025-11-15"
    },
    "telegram_id": 123456789
  }'
```

–ó–∞–º–µ–Ω–∏—Ç–µ `123456789` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π Telegram ID!

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í Telegram –ø—Ä–∏–¥—ë—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: "üÜï **–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞**..."
- curl –≤–µ—Ä–Ω—ë—Ç: `{"success": true, "message": "Notification sent"}`

### –¢–µ—Å—Ç 2: –ß–µ—Ä–µ–∑ CRM (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

1. –û—Ç–∫—Ä–æ–π—Ç–µ CRM —á–∞—Ç (https://alu.stella-spb.ru/chat)
2. –ù–∞–ø–∏—à–∏—Ç–µ: "—Å–æ–∑–¥–∞–π –≤–∞–∂–Ω—É—é –∑–∞–¥–∞—á—É –∫—É–ø–∏—Ç—å –∫—Ä—ã—à–∫–∏ –¥–ª—è —à–∫–æ–ª—ã"
3. Data Agent —Å–æ–∑–¥–∞—Å—Ç –∑–∞–¥–∞—á—É
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram (–µ—Å–ª–∏ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç –ø—Ä–∏–≤—è–∑–∞–Ω)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** –í–∞—à Telegram –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ CRM:
- –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –±–æ—Ç—É –≤ Telegram
- –ü–æ–ª—É—á–∏—Ç–µ –∫–æ–¥
- –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –≤ –ü—Ä–æ—Ñ–∏–ª–µ CRM

## –®–∞–≥ 5: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ workflow (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –Ω–æ–¥ **"Is Task Created?"** –∏ –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è:

#### Task Updated
```
type == "task_updated"
```
–°–æ–æ–±—â–µ–Ω–∏–µ:
```
üîÑ *–ó–∞–¥–∞—á–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞*\n\nüìù ${task.title}\n–°—Ç–∞—Ç—É—Å: ${task.status}
```

#### Task Deadline Reminder
```
type == "task_deadline_reminder"
```
–°–æ–æ–±—â–µ–Ω–∏–µ:
```
‚è∞ *–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –¥–µ–¥–ª–∞–π–Ω–µ*\n\nüìù ${task.title}\n–î–µ–¥–ª–∞–π–Ω: ${task.deadline}
```

#### Invoice Alert
```
type == "invoice_alert"
```
–°–æ–æ–±—â–µ–Ω–∏–µ:
```
üí∞ *–ö—Ä–∏—Ç–∏—á–Ω—ã–π —Å—á—ë—Ç*\n\nüìÑ ${invoice.invoice_number}\n–°—É–º–º–∞: ${invoice.total_amount} ‚ÇΩ\n–ü–æ—Å—Ç–∞–≤—â–∏–∫: ${invoice.supplier_name}
```

## –®–∞–≥ 6: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. –í n8n –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **"Executions"**
2. –¢–∞–º –±—É–¥—É—Ç –≤—Å–µ –∑–∞–ø—É—Å–∫–∏ workflow —Å –¥–µ—Ç–∞–ª—è–º–∏
3. –ú–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Ö–æ–¥–Ω—ã–µ/–≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥–æ–π –Ω–æ–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ webhook

```bash
curl https://n8n.alu.stella-spb.ru/webhook/telegram-notify
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è POST webhook –ø—Ä–∏ GET –∑–∞–ø—Ä–æ—Å–µ)

## Troubleshooting

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram ID:**
```sql
-- –í Supabase SQL Editor
SELECT id, email, telegram_id FROM profiles WHERE email = 'your@email.com';
```

–ï—Å–ª–∏ `telegram_id` –ø—É—Å—Ç–æ–π - –ø—Ä–∏–≤—è–∂–∏—Ç–µ Telegram —á–µ—Ä–µ–∑ `/start` –≤ –±–æ—Ç–µ

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ workflow –∞–∫—Ç–∏–≤–µ–Ω:**
- –û—Ç–∫—Ä–æ–π—Ç–µ workflow –≤ n8n
- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å **Active** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á—ë–Ω
- –ù–∞–∂–º–∏—Ç–µ **Save**

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ n8n:**
```bash
ssh root@82.97.253.12 "pm2 logs n8n --lines 50"
```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ CRM:**
```bash
ssh root@82.97.253.12 "pm2 logs crm-glazing --lines 50 | grep n8n"
```

### –û—à–∏–±–∫–∞ "Unknown event type"

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ –∑–∞–ø—Ä–æ—Å–µ –µ—Å—Ç—å –ø–æ–ª–µ `type` –∏ –æ–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–¥–Ω–æ–º—É –∏–∑:
- `task_created`
- `task_updated`
- `task_deadline_reminder`
- `invoice_alert`

### Telegram API –æ—à–∏–±–∫–∞

–ï—Å–ª–∏ –≤ –ª–æ–≥–∞—Ö n8n –æ—à–∏–±–∫–∞ –æ—Ç Telegram API:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Telegram Bot Token –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Telegram ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (—á–∏—Å–ª–æ, –Ω–µ —Å—Ç—Ä–æ–∫–∞)
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª `/start` –±–æ—Ç—É —Ö–æ—Ç—è –±—ã —Ä–∞–∑

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å workflow
2. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
3. üîÑ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π
4. üîÑ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å scheduled tasks –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
5. üîÑ –°–æ–∑–¥–∞—Ç—å dashboard –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –ì–æ—Ç–æ–≤–æ! üéâ

–¢–µ–ø–µ—Ä—å –∫–∞–∂–¥–∞—è –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞, —Å–æ–∑–¥–∞–Ω–Ω–∞—è —á–µ—Ä–µ–∑ Data Agent –≤ —á–∞—Ç–µ –∏–ª–∏ Telegram –±–æ—Ç–µ, –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é!
